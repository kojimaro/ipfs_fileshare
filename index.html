<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>IPFS Fileshare</title>

    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css">

</head>

<body id="page-top">

    <nav id="mainNav" class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <a class="navbar-brand page-scroll" href="index.html">IPFS Fileshare</a>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <section>

        <form id="ipfsForm">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <h5>You can share your file by IPFS.</h5>
                        <p> Please do not upload ilegal contents. This service assumes no responsibility.</p>
                        <div class="form-group">

                            <label class="control-label">Choose image file</label>

                            <div class="dropzone-wrapper">
                                <div class="dropzone-desc">
                                    <i class="glyphicon glyphicon-download-alt"></i>
                                    <p>Select or Drop image file</p>
                                </div>
                                <input type="file" name="img_logo" class="dropzone" id="publish" accept="image/*" onChange="readFile(this)">
                            </div>
                        </div>

                        <p id="message">
                            <p>
                                <p>
                                    <a src="" id="link"></a>
                                </p>
                    </div>
                </div>


            </div>
        </form>
    </section>


    <!-- Digital Art Chain logic -->
    <script src="js/buffer.js"></script>
    <script src="js/ipfs.js"></script>

    <script>
        var ipfs2 = window.IpfsApi({ host: 'ipfs.infura.io', protocol: 'https' })

        function readFile(input) {

            var file = document.getElementById("publish");
            var message = document.getElementById("message");
            var link = document.getElementById("link");

            message.innerHTML = "Now Loading...";
            var reader = new FileReader();
            reader.onloadend = function (event) {
                var buf = buffer.Buffer(reader.result)
                ipfs2.add(buf, (err, result) => {
                    imageHash = result[0].hash;
                    var url = "https://ipfs.io/ipfs/" + imageHash;
                    message.innerHTML = "You can share your file by following link";
                    link.innerHTML = url;
                    link.href = url;
                });
            }
            reader.readAsArrayBuffer(file.files[0]);
        }
    </script>
</body>

</html>